<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Player 1 | Motion Sensor App</title>

        <link rel="stylesheet" href="global.css">

        <script src="/socket.io/socket.io.js"></script>
        <script>
            let updateRate = 1/60;
            const socket = io();
            const player1 = io("/player1");

            function wrap(inVal, mod) {
                inVal %= mod;
                return inVal < 0 ? inVal + mod : inVal;
            }

            function getAccel(){
                DeviceMotionEvent.requestPermission().then(response => {
                    if (response == 'granted') {
                        // Add a listener to get smartphone orientation 
                        // in the alpha-beta-gamma axes (units in degrees)
                        window.addEventListener('deviceorientation', (event) => {
                            document.getElementById('orientationAlpha').textContent = "Alpha: " + wrap(event.alpha + 180, 360).toFixed(2).toString();
                            document.getElementById('orientationBeta').textContent = "Beta: " + event.beta.toFixed(2).toString();
                            document.getElementById('orientationGamma').textContent = "Gamma: " + event.gamma.toFixed(2).toString();

                            player1.emit('orient', {alpha: event.alpha, beta: event.beta, gamma: event.gamma});
                        });

                        // Add a listener to get smartphone acceleration 
                        // in the XYZ axes (units in m/s^2)
                        window.addEventListener('devicemotion', (event) => {
                            // if event.rotationRate, use that; else use event.accelerationIncludingGravity
                            if (event.rotationRate) {
                                document.getElementById('motionAlpha').textContent = "Alpha: " + Math.round(event.rotationRate.alpha).toString();
                                document.getElementById('motionBeta').textContent = "Beta: " + Math.round(event.rotationRate.beta).toString();
                                document.getElementById('motionGamma').textContent = "Gamma: " + Math.round(event.rotationRate.gamma).toString();

                                player1.emit('motion', event.rotationRate);
                            } else {
                                document.getElementById('motionAlpha').textContent = "X: " + Math.round(event.accelerationIncludingGravity.x).toString();
                                document.getElementById('motionBeta').textContent = "Y: " + Math.round(event.accelerationIncludingGravity.y).toString();
                                document.getElementById('motionGamma').textContent = "Z: " + Math.round(event.accelerationIncludingGravity.z).toString();

                                player1.emit('accel', event.accelerationIncludingGravity);
                            }
                        });

                        
                    }
                });
            }
        </script>
    </head>
    <body>
        
        <button id="accelPermsButton" onclick="getAccel()">Get Sensor Permissions</button>
        <p>Return to <a href="index.html">performer list</a></p>
        <h1>Device Orientation:</h1>
        <p><span id="orientationAlpha"></span></p><br/>
        <p><span id="orientationBeta"></span></p><br/>
        <p><span id="orientationGamma"></span></p><br/>
        <h1>Device Motion Rate:</h1>
        <p><span id="motionAlpha"></span></p><br/>
        <p><span id="motionBeta"></span></p><br/>
        <p><span id="motionGamma"></span></p><br/>

    </body>
</html>